# Workday Weather

[Workday Weather](https://ayating.github.io/WorkdayWeather/)

Workday Weather，設計靈感來自每天上班前查看天氣的習慣。

本專案為上班族用來查詢天氣狀況，並抒發心情的小型即時互動平台。讓上班族能於出門前確認天氣，並有個聊天室管道，建立人與人之間的支持網絡，例如：看到雷雨預報時，有人留言『希望今天準時下班』、或提醒同地區的使用者『這邊已經開始下雨了』，讓氣象不只是一個數據，更是打開對話的起點，形成一種帶有社群感的氣象日常入口。

技術上，使用 RWD 讓網頁適用於各種螢幕尺寸，以 javascript 串接中華民國交通部中央氣象局 API，使用 SSE 建立後端推送機制，讓聊天室訊息能即時更新、增加互動感。

## 功能說明

<h3>互動式地圖點擊效果</h3>
  使用者可點擊台灣地圖上的任一縣市，立即取得該地區的天氣資訊。
<h3>即時天氣資訊顯示</h3>
  提供所選縣市的即時天氣狀況，資訊包含天氣概況（晴、陰、多雲、降雨）、降雨機率及相對濕度。
<h3>一週天氣預測切換</h3>
  呈現從今日起的一週天氣預報，並依據使用者點選的縣市，自動切換顯示當地的七日天氣趨勢。
<h3>下雨動畫特效</h3>
  當偵測到當地天氣為降雨時，背景自動觸發細雨動畫，營造符合當下氣候的沉浸式視覺體驗。

## 資料串接

<h3>當日天氣資訊</h3>

- API：台灣未來三天天氣預報
  https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-D0047-089?Authorization=${apiKey}

- 使用 javascript fetch（）方法，進行 GET 請求，取得資料

- 即時溫度、即時濕度：

  利用條件判斷查找下一小時的資料，並用 find（）方法返回。

- 即時天氣描述、即時降雨率：

  利用條件判斷，查找包含當前時間的區間資料，並用 find（）方法返回。

<h3>一週天氣資訊</h3>

- API：台灣未來一週天氣預報
  https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-D0047-091?Authorization=${apiKey}

- 一週溫度、一週天氣描述：
  　由於目標使用者對象為上班族，我們所呈現的一週天氣資訊，選用早上六點至晚上六點區間之資料，一週天氣資訊欄位中的第一天，同步即時氣象資訊，第二天開始的欄位，使用 javascript fetch()方法串接一週天氣 API 。

- 由於氣象局資料會根據時間做動態更新，我們使用條件判斷，固定蒐集第二天至第七天的資料，排除前後的不穩定性，並蒐集初始時間為早上六點的資料，排除夜間與凌晨的資料，作為一週天氣資料，再使用 unshift()方法插入上一支 API 的即時資料，作為第一天之資料。

<h3>聊天室資訊</h3>

- 透過 SSE（Server-Sent Events）機制與 eventsource 物件，建立與伺服器的即時通訊連線，使前端能自動接收新訊息，即時更新畫面。

## 聊天室

- 使用了 SSE（Server-Sent Events）技術，我們的做法是，使用者發送訊息時會透過 POST 請求送到後端，後端將訊息暫存於 deque（類似串列的資料結構），並透過 SSE 即時推送給其他使用者，營造出類似雙向的互動感。」

- 訊息提交與驗證：使用者可透過指定的 API 端點發送文字訊息。系統接收後會立即檢查內容是否為空、長度是否超過 100 字，確保輸入的基本有效性。

- 即時訊息廣播 (SSE) ：採用 Server-Sent Events (SSE) 技術，當一則新訊息通過驗證並儲存後，伺服器會主動將該訊息即時「推送」給所有已建立 SSE 連線的客戶端。

- 訊息暫存與讀取 ： 成功提交的訊息會附加當下時間戳（台北時區），並以 deque 的形式，儲存在伺服器記憶體中的佇列裡（限制最多 50 則最新訊息）。另提供 API 供客戶端一次性獲取當前所有訊息列表。

- 跨日自動清理與通知 ：內建背景排程任務，每日監測（以台北時區為準）是否已跨至新的一天。若偵測到跨日，系統會自動清空所有儲存的訊息紀錄，並透過 SSE 通道發送清除指令給所有客戶端，觸發前端介面重置。

## 任務分工

- 丁綾葳（組長）：聊天室 API、前後端上線

- 邵佳渝：版面配置規劃、畫面渲染

- 蕭郁蓁:氣象資料處理、前後端串接、README 撰寫
